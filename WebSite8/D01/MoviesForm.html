<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <style>
        body {
            margin: 4px;
            padding-top: 3px;
            padding-right: 3px;
            padding-bottom: 5px;
            padding-left: 12px;
        }

        h2 {
            padding-left: 14px;
        }

        p{
            font-size:15px;
        }

    </style>

</head>
<body>

    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <h2>Get Data</h2>
                <br>
                <div id="container">
                    <p>LOADING DATA, PLEASE WAIT</p>
                </div>
            </div>
            <div class="col-md-6">
                <h2 style="padding-left: 0px">Movies Form</h2>
                <br>
                <!--<form>-->
                <div class="form-group">
                    <label for="input1">Id</label>
                    <input type="text" class="form-control" id="input1" aria-describedby="emailHelp" placeholder="Enter Id">
                </div>
                <div class="form-group">
                    <label for="input2">Date</label>
                    <input type="text" class="form-control" id="input2" placeholder="??/??/??">
                </div>
                <div class="form-group">
                    <label for="input3">Movie</label>
                    <input type="text" class="form-control" id="input3" aria-describedby="emailHelp" placeholder="Movie Name">
                </div>
                <div class="form-group">
                    <label for="input4">Platform</label>
                    <input type="text" class="form-control" id="input4" placeholder="Platform">
                </div>
                <button class="btn btn-primary" onclick="getFormData()">Create/Update</button>
                <button class="btn btn-primary" onclick="deleteItem()">Delete Item</button>
                <!--</form>-->
            </div>
            
        </div><br><hr>
    </div>


    <script>

        var container = document.getElementById("container");
        var asyncCounter = 0;

        async function getAPIData() {

            const response = await fetch('https://getpantry.cloud/apiv1/pantry/5638cc37-8155-4163-ad08-7e4c6de5ee57');
            var data = await response.json();

            var resLength = data.baskets.length;
            var arr = new Array(resLength);

            for (var i = 0; i < arr.length; i++) {
                arr[i] = new Array(4);
            }

            asyncCounter = 0;

            for (var j = 0; j < data.baskets.length; j++) {
                var dataNo1 = data.baskets[j];
                getAPIDataDisplay(dataNo1, arr, j, resLength);
            }
        }
        getAPIData();


        async function getAPIDataDisplay(dataNo1, arr, j, resLength) {

            const response = await fetch('https://getpantry.cloud/apiv1/pantry/5638cc37-8155-4163-ad08-7e4c6de5ee57/basket/' + dataNo1);
            var data = await response.json();
            asyncCounter++;

            arr[j][0] = data.id;
            arr[j][1] = data.date;
            arr[j][2] = data.movie;
            arr[j][3] = data.name;

            console.log("array id    = " + arr[j][0]);
            console.log("array date  = " + arr[j][1]);
            console.log("array movie = " + arr[j][2]);
            console.log("array name  = " + arr[j][3]);
            console.log("\n");

            if (asyncCounter == resLength) {

                console.log("Array is full!");
                container.innerHTML = '';

                for (var i = 0; i < resLength; i++) {
                    container.innerHTML += '<div class="container-fluid"><div class="row"><div class="col-xs-2"><p id="newContent">' + arr[i][0] +
                        '</p></div><div class="col-xs-4"><p id="newQuote">' + arr[i][1] +
                        '</p></div><div class="col-xs-3"><p id="newQuote">' + arr[i][2] +
                        '</p></div><div class="col-xs-3"><p id="newQuote">' + arr[i][3] +
                        '</p></div></div></div><br>';
                }
            }
        }

        function getFormData() {
            var movieId = document.querySelector("#input1").value;
            var movieDate = document.querySelector("#input2").value;
            var movieName = document.querySelector("#input3").value;
            var moviePlatform = document.querySelector('#input4').value;

            console.log(movieId);
            console.log(movieDate);
            console.log(movieName);
            console.log(moviePlatform);

            saveToAPI(movieId, movieDate, movieName, moviePlatform);
        }

        async function saveToAPI(movieId, movieDate, movieName, moviePlatform) {

            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
                "id": movieId,
                "date": movieDate,
                "movie": movieName,
                "name": moviePlatform,
                "testPayload": true,
                "keysLength": 5
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("https://getpantry.cloud/apiv1/pantry/5638cc37-8155-4163-ad08-7e4c6de5ee57/basket/" + movieId, requestOptions)
                .then(response => response.text())
                .then(result => console.log(result))
                .then(setTimeout(getAPIData, 600))
                .catch(error => console.log('error', error));
        };

        function deleteItem()
        {
            var movieId = document.querySelector("#input1").value;
            deleteBasket(movieId);
        }

        async function deleteBasket(movieId) {
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            console.log("https://getpantry.cloud/apiv1/pantry/5638cc37-8155-4163-ad08-7e4c6de5ee57/basket/" + movieId);

            var raw = "";

            var requestOptions = {
                method: 'DELETE',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("https://getpantry.cloud/apiv1/pantry/5638cc37-8155-4163-ad08-7e4c6de5ee57/basket/" + movieId, requestOptions)
                .then(response => response.text())
                .then(result => console.log(result))
                .then(setTimeout(getAPIData, 600))
                .catch(error => console.log('error', error));
        };
    </script>

</body>
</html>